#!/usr/bin/env bash
echo "Running script.sh.erb script"

echo "module purge"
module purge

# load matlab Server
echo "module load"
module load <%= context.ansysver %>
source <%= context.ansyslic %> || exit
export ANSYSLMD_LICENSE_FILE=$ANSYSLI_SERVERS
export ANSOFTD_LICENSE_FILE=$ANSYSLI_SERVERS

# load 
module load matlab-proxy

# matlabServer doesn't inherit "ulimit -s" from system config /etc/security/limits.d/custom.conf
# Therefore, we are setting it here
ulimit -s unlimited

#
# Start matlab Server
#

TMPDIR="$(mktemp -d)"


# Launch the matlab Server
echo "Starting up Fluent..."
set -x
fluent <%= context.is3d %><%= context.prescision %> <%= context.ismeshing %> -mpi=openmpi -nm -ws -ws-port=5000 -ws-portspan=0
